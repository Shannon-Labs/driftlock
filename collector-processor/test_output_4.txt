# github.com/Shannon-Labs/driftlock/collector-processor/cmd/driftlock-http.test
ld: warning: ignoring duplicate libraries: '-lcbad_core'
=== RUN   TestBillingStatusEndpoint
    e2e_billing_test.go:17: Failed to run migrations: ERROR 20251201000000_ai_cost_control.sql: failed to run SQL migration: failed to execute SQL query "CREATE INDEX idx_ai_usage_tenant_date ON ai_usage(tenant_id, DATE(created_at));": ERROR: functions in index expression must be marked IMMUTABLE (SQLSTATE 42P17)
--- FAIL: TestBillingStatusEndpoint (0.04s)
=== RUN   TestCheckoutSessionCreation
    e2e_billing_test.go:72: STRIPE_SECRET_KEY not set, skipping checkout test
--- SKIP: TestCheckoutSessionCreation (0.00s)
=== RUN   TestTrialCountdownAccuracy
    e2e_billing_test.go:135: Failed to run migrations: ERROR 20251201000000_ai_cost_control.sql: failed to run SQL migration: failed to execute SQL query "CREATE INDEX idx_ai_usage_tenant_date ON ai_usage(tenant_id, DATE(created_at));": ERROR: functions in index expression must be marked IMMUTABLE (SQLSTATE 42P17)
--- FAIL: TestTrialCountdownAccuracy (0.02s)
=== RUN   TestGracePeriodLogic
    e2e_billing_test.go:193: Failed to run migrations: ERROR 20251201000000_ai_cost_control.sql: failed to run SQL migration: failed to execute SQL query "CREATE INDEX idx_ai_usage_tenant_date ON ai_usage(tenant_id, DATE(created_at));": ERROR: functions in index expression must be marked IMMUTABLE (SQLSTATE 42P17)
--- FAIL: TestGracePeriodLogic (0.02s)
=== RUN   TestWebhookSignatureRequired
    e2e_billing_test.go:280: Failed to run migrations: ERROR 20251201000000_ai_cost_control.sql: failed to run SQL migration: failed to execute SQL query "CREATE INDEX idx_ai_usage_tenant_date ON ai_usage(tenant_id, DATE(created_at));": ERROR: functions in index expression must be marked IMMUTABLE (SQLSTATE 42P17)
--- FAIL: TestWebhookSignatureRequired (0.02s)
=== RUN   TestOnboardingFlow
    e2e_onboarding_test.go:12: Failed to run migrations: ERROR 20251201000000_ai_cost_control.sql: failed to run SQL migration: failed to execute SQL query "CREATE INDEX idx_ai_usage_tenant_date ON ai_usage(tenant_id, DATE(created_at));": ERROR: functions in index expression must be marked IMMUTABLE (SQLSTATE 42P17)
--- FAIL: TestOnboardingFlow (0.02s)
=== RUN   TestSignupValidation
    e2e_onboarding_test.go:89: Failed to run migrations: ERROR 20251201000000_ai_cost_control.sql: failed to run SQL migration: failed to execute SQL query "CREATE INDEX idx_ai_usage_tenant_date ON ai_usage(tenant_id, DATE(created_at));": ERROR: functions in index expression must be marked IMMUTABLE (SQLSTATE 42P17)
--- FAIL: TestSignupValidation (0.03s)
=== RUN   TestDuplicateEmailRejected
    e2e_onboarding_test.go:143: Failed to run migrations: ERROR 20251201000000_ai_cost_control.sql: failed to run SQL migration: failed to execute SQL query "CREATE INDEX idx_ai_usage_tenant_date ON ai_usage(tenant_id, DATE(created_at));": ERROR: functions in index expression must be marked IMMUTABLE (SQLSTATE 42P17)
--- FAIL: TestDuplicateEmailRejected (0.02s)
=== RUN   TestVerificationTokenValidation
    e2e_onboarding_test.go:169: Failed to run migrations: ERROR 20251201000000_ai_cost_control.sql: failed to run SQL migration: failed to execute SQL query "CREATE INDEX idx_ai_usage_tenant_date ON ai_usage(tenant_id, DATE(created_at));": ERROR: functions in index expression must be marked IMMUTABLE (SQLSTATE 42P17)
--- FAIL: TestVerificationTokenValidation (0.02s)
=== RUN   TestSignupRateLimiting
    e2e_onboarding_test.go:187: Failed to run migrations: ERROR 20251201000000_ai_cost_control.sql: failed to run SQL migration: failed to execute SQL query "CREATE INDEX idx_ai_usage_tenant_date ON ai_usage(tenant_id, DATE(created_at));": ERROR: functions in index expression must be marked IMMUTABLE (SQLSTATE 42P17)
--- FAIL: TestSignupRateLimiting (0.02s)
=== RUN   TestAPIKeyAuthAfterVerification
    e2e_onboarding_test.go:225: Failed to run migrations: ERROR 20251201000000_ai_cost_control.sql: failed to run SQL migration: failed to execute SQL query "CREATE INDEX idx_ai_usage_tenant_date ON ai_usage(tenant_id, DATE(created_at));": ERROR: functions in index expression must be marked IMMUTABLE (SQLSTATE 42P17)
--- FAIL: TestAPIKeyAuthAfterVerification (0.02s)
=== RUN   TestUnauthorizedDetection
    e2e_onboarding_test.go:287: Failed to run migrations: ERROR 20251201000000_ai_cost_control.sql: failed to run SQL migration: failed to execute SQL query "CREATE INDEX idx_ai_usage_tenant_date ON ai_usage(tenant_id, DATE(created_at));": ERROR: functions in index expression must be marked IMMUTABLE (SQLSTATE 42P17)
--- FAIL: TestUnauthorizedDetection (0.02s)
=== RUN   TestLoadLicenseValid
--- PASS: TestLoadLicenseValid (0.00s)
=== RUN   TestLoadLicenseInvalidSignature
--- PASS: TestLoadLicenseInvalidSignature (0.00s)
=== RUN   TestLoadLicenseExpired
--- PASS: TestLoadLicenseExpired (0.00s)
=== RUN   TestTenantRateLimiter_TenantLimit
--- PASS: TestTenantRateLimiter_TenantLimit (0.00s)
=== RUN   TestTenantRateLimiter_KeyLimit
--- PASS: TestTenantRateLimiter_KeyLimit (0.00s)
=== RUN   TestDecorateRateLimitHeaders
--- PASS: TestDecorateRateLimitHeaders (0.00s)
FAIL
FAIL	github.com/Shannon-Labs/driftlock/collector-processor/cmd/driftlock-http	0.641s
FAIL
