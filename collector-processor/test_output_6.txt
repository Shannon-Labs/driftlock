# github.com/Shannon-Labs/driftlock/collector-processor/cmd/driftlock-http.test
ld: warning: ignoring duplicate libraries: '-lcbad_core'
=== RUN   TestBillingStatusEndpoint
2025/12/01 21:32:55 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59752","request_id":"1764646375958266000","ts":"2025-12-01T21:32:55.958278-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:55 {"details":"status=201","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59752","request_id":"1764646375958266000","ts":"2025-12-01T21:32:55.962064-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:55 {"event":"request_start","method":"GET","path":"/v1/onboard/verify","query":"token=HSM1UaUHSqNrXDPir4Xx-lh0wfru3OUDjvsDUug-FlE=","remote":"127.0.0.1:59752","request_id":"1764646375962667000","ts":"2025-12-01T21:32:55.962668-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"details":"status=200","event":"request_complete","method":"GET","path":"/v1/onboard/verify","query":"token=HSM1UaUHSqNrXDPir4Xx-lh0wfru3OUDjvsDUug-FlE=","remote":"127.0.0.1:59752","request_id":"1764646375962667000","ts":"2025-12-01T21:32:56.00719-06:00","user_agent":"Go-http-client/1.1"}
=== RUN   TestBillingStatusEndpoint/BillingStatusViaAPIKey
2025/12/01 21:32:56 {"event":"request_start","method":"GET","path":"/v1/me/billing","query":"","remote":"127.0.0.1:59752","request_id":"1764646376107569000","ts":"2025-12-01T21:32:56.107571-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"details":"http_status=401","error":"missing bearer token","error_type":"unauthorized","event":"error","method":"GET","path":"/v1/me/billing","remote":"127.0.0.1:59752","request_id":"1764646376107569000","ts":"2025-12-01T21:32:56.107589-06:00"}
2025/12/01 21:32:56 {"details":"status=401","event":"request_complete","method":"GET","path":"/v1/me/billing","query":"","remote":"127.0.0.1:59752","request_id":"1764646376107569000","ts":"2025-12-01T21:32:56.107613-06:00","user_agent":"Go-http-client/1.1"}
    e2e_billing_test.go:58: Billing endpoint requires Firebase Auth (expected in production)
--- PASS: TestBillingStatusEndpoint (0.21s)
    --- PASS: TestBillingStatusEndpoint/BillingStatusViaAPIKey (0.00s)
=== RUN   TestCheckoutSessionCreation
    e2e_billing_test.go:72: STRIPE_SECRET_KEY not set, skipping checkout test
--- SKIP: TestCheckoutSessionCreation (0.00s)
=== RUN   TestTrialCountdownAccuracy
2025/12/01 21:32:56 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59756","request_id":"1764646376134299000","ts":"2025-12-01T21:32:56.1343-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"details":"status=201","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59756","request_id":"1764646376134299000","ts":"2025-12-01T21:32:56.138771-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"event":"request_start","method":"GET","path":"/v1/onboard/verify","query":"token=oLrdQU9ftYoIBLz-LYYrqnvxqNpLGgfRV-vMeKBLXiI=","remote":"127.0.0.1:59756","request_id":"1764646376139524000","ts":"2025-12-01T21:32:56.139525-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"details":"status=200","event":"request_complete","method":"GET","path":"/v1/onboard/verify","query":"token=oLrdQU9ftYoIBLz-LYYrqnvxqNpLGgfRV-vMeKBLXiI=","remote":"127.0.0.1:59756","request_id":"1764646376139524000","ts":"2025-12-01T21:32:56.183755-06:00","user_agent":"Go-http-client/1.1"}
    e2e_billing_test.go:188: Trial ends at 2025-12-08T21:32:56-06:00, 6 days remaining
--- PASS: TestTrialCountdownAccuracy (0.07s)
=== RUN   TestGracePeriodLogic
2025/12/01 21:32:56 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59760","request_id":"1764646376197464000","ts":"2025-12-01T21:32:56.197465-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"details":"status=201","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59760","request_id":"1764646376197464000","ts":"2025-12-01T21:32:56.201031-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"event":"request_start","method":"GET","path":"/v1/onboard/verify","query":"token=qo4KN_fgUJ56Sfxmq2QbatZHCD05rqWbtoXwih8Uh9s=","remote":"127.0.0.1:59760","request_id":"1764646376201617000","ts":"2025-12-01T21:32:56.201618-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"details":"status=200","event":"request_complete","method":"GET","path":"/v1/onboard/verify","query":"token=qo4KN_fgUJ56Sfxmq2QbatZHCD05rqWbtoXwih8Uh9s=","remote":"127.0.0.1:59760","request_id":"1764646376201617000","ts":"2025-12-01T21:32:56.241518-06:00","user_agent":"Go-http-client/1.1"}
=== RUN   TestGracePeriodLogic/SetGracePeriod
    e2e_billing_test.go:248: Grace period set until 2025-12-08T21:32:56-06:00, failure count: 1
=== RUN   TestGracePeriodLogic/ClearGracePeriod
    e2e_billing_test.go:274: Grace period cleared successfully
--- PASS: TestGracePeriodLogic (0.06s)
    --- PASS: TestGracePeriodLogic/SetGracePeriod (0.00s)
    --- PASS: TestGracePeriodLogic/ClearGracePeriod (0.00s)
=== RUN   TestWebhookSignatureRequired
2025/12/01 21:32:56 {"event":"request_start","method":"POST","path":"/v1/billing/webhook","query":"","remote":"127.0.0.1:59764","request_id":"1764646376256774000","ts":"2025-12-01T21:32:56.256775-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 Error verifying webhook signature: webhook has no Stripe-Signature header
2025/12/01 21:32:56 {"details":"status=400","event":"request_complete","method":"POST","path":"/v1/billing/webhook","query":"","remote":"127.0.0.1:59764","request_id":"1764646376256774000","ts":"2025-12-01T21:32:56.256818-06:00","user_agent":"Go-http-client/1.1"}
    e2e_billing_test.go:300: Webhook correctly rejected (status 400)
--- PASS: TestWebhookSignatureRequired (0.01s)
=== RUN   TestOnboardingFlow
=== RUN   TestOnboardingFlow/SignupCreatesUnverifiedTenant
2025/12/01 21:32:56 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59768","request_id":"1764646376266675000","ts":"2025-12-01T21:32:56.266675-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"details":"status=201","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59768","request_id":"1764646376266675000","ts":"2025-12-01T21:32:56.270478-06:00","user_agent":"Go-http-client/1.1"}
    e2e_onboarding_test.go:33: Failed to get tenant status: ERROR: column "email_verified_at" does not exist (SQLSTATE 42703)
=== RUN   TestOnboardingFlow/VerifyActivatesTenant
2025/12/01 21:32:56 {"event":"request_start","method":"GET","path":"/v1/onboard/verify","query":"token=-zluBLdqOp5DtjF7Uhw3cewCl5t7rhS9H7RF_TxrC0s=","remote":"127.0.0.1:59768","request_id":"1764646376271432000","ts":"2025-12-01T21:32:56.271432-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"details":"status=200","event":"request_complete","method":"GET","path":"/v1/onboard/verify","query":"token=-zluBLdqOp5DtjF7Uhw3cewCl5t7rhS9H7RF_TxrC0s=","remote":"127.0.0.1:59768","request_id":"1764646376271432000","ts":"2025-12-01T21:32:56.307755-06:00","user_agent":"Go-http-client/1.1"}
    e2e_onboarding_test.go:73: Failed to get tenant status: ERROR: column "email_verified_at" does not exist (SQLSTATE 42703)
--- FAIL: TestOnboardingFlow (0.05s)
    --- FAIL: TestOnboardingFlow/SignupCreatesUnverifiedTenant (0.00s)
    --- FAIL: TestOnboardingFlow/VerifyActivatesTenant (0.04s)
=== RUN   TestSignupValidation
=== RUN   TestSignupValidation/MissingEmail
2025/12/01 21:32:56 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59772","request_id":"1764646376319705000","ts":"2025-12-01T21:32:56.319706-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"details":"http_status=400","error":"email is required","error_type":"invalid_argument","event":"error","method":"POST","path":"/v1/onboard/signup","remote":"127.0.0.1:59772","request_id":"1764646376319705000","ts":"2025-12-01T21:32:56.319729-06:00"}
2025/12/01 21:32:56 {"details":"status=400","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59772","request_id":"1764646376319705000","ts":"2025-12-01T21:32:56.319738-06:00","user_agent":"Go-http-client/1.1"}
=== RUN   TestSignupValidation/InvalidEmail
2025/12/01 21:32:56 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59772","request_id":"1764646376319851000","ts":"2025-12-01T21:32:56.319852-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"details":"http_status=400","error":"invalid email format","error_type":"invalid_argument","event":"error","method":"POST","path":"/v1/onboard/signup","remote":"127.0.0.1:59772","request_id":"1764646376319851000","ts":"2025-12-01T21:32:56.319862-06:00"}
2025/12/01 21:32:56 {"details":"status=400","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59772","request_id":"1764646376319851000","ts":"2025-12-01T21:32:56.319867-06:00","user_agent":"Go-http-client/1.1"}
=== RUN   TestSignupValidation/MissingCompanyName
2025/12/01 21:32:56 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59772","request_id":"1764646376319959000","ts":"2025-12-01T21:32:56.31996-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"details":"http_status=400","error":"company_name is required","error_type":"invalid_argument","event":"error","method":"POST","path":"/v1/onboard/signup","remote":"127.0.0.1:59772","request_id":"1764646376319959000","ts":"2025-12-01T21:32:56.31997-06:00"}
2025/12/01 21:32:56 {"details":"status=400","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59772","request_id":"1764646376319959000","ts":"2025-12-01T21:32:56.319976-06:00","user_agent":"Go-http-client/1.1"}
=== RUN   TestSignupValidation/CompanyNameTooShort
2025/12/01 21:32:56 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59772","request_id":"1764646376320095000","ts":"2025-12-01T21:32:56.320096-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"details":"http_status=400","error":"company_name must be at least 2 characters","error_type":"invalid_argument","event":"error","method":"POST","path":"/v1/onboard/signup","remote":"127.0.0.1:59772","request_id":"1764646376320095000","ts":"2025-12-01T21:32:56.320107-06:00"}
2025/12/01 21:32:56 {"details":"status=400","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59772","request_id":"1764646376320095000","ts":"2025-12-01T21:32:56.320113-06:00","user_agent":"Go-http-client/1.1"}
=== RUN   TestSignupValidation/InvalidPlan
2025/12/01 21:32:56 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59772","request_id":"1764646376320221000","ts":"2025-12-01T21:32:56.320221-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"details":"http_status=400","error":"invalid plan: must be one of trial, starter, growth, pilot","error_type":"invalid_argument","event":"error","method":"POST","path":"/v1/onboard/signup","remote":"127.0.0.1:59772","request_id":"1764646376320221000","ts":"2025-12-01T21:32:56.320229-06:00"}
2025/12/01 21:32:56 {"details":"status=400","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59772","request_id":"1764646376320221000","ts":"2025-12-01T21:32:56.320236-06:00","user_agent":"Go-http-client/1.1"}
--- PASS: TestSignupValidation (0.01s)
    --- PASS: TestSignupValidation/MissingEmail (0.00s)
    --- PASS: TestSignupValidation/InvalidEmail (0.00s)
    --- PASS: TestSignupValidation/MissingCompanyName (0.00s)
    --- PASS: TestSignupValidation/CompanyNameTooShort (0.00s)
    --- PASS: TestSignupValidation/InvalidPlan (0.00s)
=== RUN   TestDuplicateEmailRejected
2025/12/01 21:32:56 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59779","request_id":"1764646376330657000","ts":"2025-12-01T21:32:56.330664-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"details":"status=201","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59779","request_id":"1764646376330657000","ts":"2025-12-01T21:32:56.334465-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59779","request_id":"1764646376334597000","ts":"2025-12-01T21:32:56.334598-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"details":"http_status=409","error":"email already registered","error_type":"internal","event":"error","method":"POST","path":"/v1/onboard/signup","remote":"127.0.0.1:59779","request_id":"1764646376334597000","ts":"2025-12-01T21:32:56.334891-06:00"}
2025/12/01 21:32:56 {"details":"status=409","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59779","request_id":"1764646376334597000","ts":"2025-12-01T21:32:56.3349-06:00","user_agent":"Go-http-client/1.1"}
--- PASS: TestDuplicateEmailRejected (0.02s)
=== RUN   TestVerificationTokenValidation
=== RUN   TestVerificationTokenValidation/MissingToken
2025/12/01 21:32:56 {"event":"request_start","method":"GET","path":"/v1/onboard/verify","query":"","remote":"127.0.0.1:59783","request_id":"1764646376346455000","ts":"2025-12-01T21:32:56.346455-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"details":"http_status=400","error":"verification token required","error_type":"invalid_argument","event":"error","method":"GET","path":"/v1/onboard/verify","remote":"127.0.0.1:59783","request_id":"1764646376346455000","ts":"2025-12-01T21:32:56.346472-06:00"}
2025/12/01 21:32:56 {"details":"status=400","event":"request_complete","method":"GET","path":"/v1/onboard/verify","query":"","remote":"127.0.0.1:59783","request_id":"1764646376346455000","ts":"2025-12-01T21:32:56.346478-06:00","user_agent":"Go-http-client/1.1"}
=== RUN   TestVerificationTokenValidation/InvalidToken
2025/12/01 21:32:56 {"event":"request_start","method":"GET","path":"/v1/onboard/verify","query":"token=invalid_token_xyz","remote":"127.0.0.1:59783","request_id":"1764646376346586000","ts":"2025-12-01T21:32:56.346586-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"details":"http_status=400","error":"invalid or expired verification token","error_type":"invalid_argument","event":"error","method":"GET","path":"/v1/onboard/verify","remote":"127.0.0.1:59783","request_id":"1764646376346586000","ts":"2025-12-01T21:32:56.347051-06:00"}
2025/12/01 21:32:56 {"details":"status=400","event":"request_complete","method":"GET","path":"/v1/onboard/verify","query":"token=invalid_token_xyz","remote":"127.0.0.1:59783","request_id":"1764646376346586000","ts":"2025-12-01T21:32:56.34706-06:00","user_agent":"Go-http-client/1.1"}
--- PASS: TestVerificationTokenValidation (0.01s)
    --- PASS: TestVerificationTokenValidation/MissingToken (0.00s)
    --- PASS: TestVerificationTokenValidation/InvalidToken (0.00s)
=== RUN   TestSignupRateLimiting
2025/12/01 21:32:56 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59787","request_id":"1764646376356697000","ts":"2025-12-01T21:32:56.356698-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"details":"status=201","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59787","request_id":"1764646376356697000","ts":"2025-12-01T21:32:56.3604-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59787","request_id":"1764646376360536000","ts":"2025-12-01T21:32:56.360537-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"details":"http_status=500","error":"failed to create tenant: ERROR: duplicate key value violates unique constraint \"tenants_slug_key\" (SQLSTATE 23505)","error_type":"internal","event":"error","method":"POST","path":"/v1/onboard/signup","remote":"127.0.0.1:59787","request_id":"1764646376360536000","ts":"2025-12-01T21:32:56.361583-06:00"}
2025/12/01 21:32:56 {"details":"status=500","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59787","request_id":"1764646376360536000","ts":"2025-12-01T21:32:56.361591-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59787","request_id":"1764646376361683000","ts":"2025-12-01T21:32:56.361683-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"details":"http_status=500","error":"failed to create tenant: ERROR: duplicate key value violates unique constraint \"tenants_slug_key\" (SQLSTATE 23505)","error_type":"internal","event":"error","method":"POST","path":"/v1/onboard/signup","remote":"127.0.0.1:59787","request_id":"1764646376361683000","ts":"2025-12-01T21:32:56.362755-06:00"}
2025/12/01 21:32:56 {"details":"status=500","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59787","request_id":"1764646376361683000","ts":"2025-12-01T21:32:56.362765-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59787","request_id":"1764646376362868000","ts":"2025-12-01T21:32:56.362868-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"details":"http_status=500","error":"failed to create tenant: ERROR: duplicate key value violates unique constraint \"tenants_slug_key\" (SQLSTATE 23505)","error_type":"internal","event":"error","method":"POST","path":"/v1/onboard/signup","remote":"127.0.0.1:59787","request_id":"1764646376362868000","ts":"2025-12-01T21:32:56.364838-06:00"}
2025/12/01 21:32:56 {"details":"status=500","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59787","request_id":"1764646376362868000","ts":"2025-12-01T21:32:56.364844-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59787","request_id":"1764646376364919000","ts":"2025-12-01T21:32:56.364919-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"details":"http_status=500","error":"failed to create tenant: ERROR: duplicate key value violates unique constraint \"tenants_slug_key\" (SQLSTATE 23505)","error_type":"internal","event":"error","method":"POST","path":"/v1/onboard/signup","remote":"127.0.0.1:59787","request_id":"1764646376364919000","ts":"2025-12-01T21:32:56.365685-06:00"}
2025/12/01 21:32:56 {"details":"status=500","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59787","request_id":"1764646376364919000","ts":"2025-12-01T21:32:56.365696-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59787","request_id":"1764646376365773000","ts":"2025-12-01T21:32:56.365773-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"details":"http_status=500","error":"failed to create tenant: ERROR: duplicate key value violates unique constraint \"tenants_slug_key\" (SQLSTATE 23505)","error_type":"internal","event":"error","method":"POST","path":"/v1/onboard/signup","remote":"127.0.0.1:59787","request_id":"1764646376365773000","ts":"2025-12-01T21:32:56.36669-06:00"}
2025/12/01 21:32:56 {"details":"status=500","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59787","request_id":"1764646376365773000","ts":"2025-12-01T21:32:56.366702-06:00","user_agent":"Go-http-client/1.1"}
    e2e_onboarding_test.go:220: Warning: Rate limiting may not have triggered in test environment
--- PASS: TestSignupRateLimiting (0.02s)
=== RUN   TestAPIKeyAuthAfterVerification
2025/12/01 21:32:56 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59791","request_id":"1764646376377987000","ts":"2025-12-01T21:32:56.377988-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"details":"status=201","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59791","request_id":"1764646376377987000","ts":"2025-12-01T21:32:56.380711-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"event":"request_start","method":"GET","path":"/v1/onboard/verify","query":"token=n-VxgBx7d6GClYWgD4pmTZrQecU3Rco0XvCnmxRSWZ0=","remote":"127.0.0.1:59791","request_id":"1764646376381229000","ts":"2025-12-01T21:32:56.38123-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"details":"status=200","event":"request_complete","method":"GET","path":"/v1/onboard/verify","query":"token=n-VxgBx7d6GClYWgD4pmTZrQecU3Rco0XvCnmxRSWZ0=","remote":"127.0.0.1:59791","request_id":"1764646376381229000","ts":"2025-12-01T21:32:56.419309-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"event":"request_start","method":"POST","path":"/v1/detect","query":"","remote":"127.0.0.1:59791","request_id":"1764646376520699000","ts":"2025-12-01T21:32:56.520701-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"details":"status=200","event":"request_complete","method":"POST","path":"/v1/detect","query":"","remote":"127.0.0.1:59791","request_id":"1764646376520699000","ts":"2025-12-01T21:32:56.572306-06:00","user_agent":"Go-http-client/1.1"}
    e2e_onboarding_test.go:282: Detection successful: 3 events, 0 anomalies
--- PASS: TestAPIKeyAuthAfterVerification (0.21s)
=== RUN   TestUnauthorizedDetection
2025/12/01 21:32:56 {"event":"request_start","method":"POST","path":"/v1/detect","query":"","remote":"127.0.0.1:59796","request_id":"1764646376590610000","ts":"2025-12-01T21:32:56.590611-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:32:56 {"details":"http_status=401","error":"missing api key","error_type":"unauthorized","event":"error","method":"POST","path":"/v1/detect","remote":"127.0.0.1:59796","request_id":"1764646376590610000","ts":"2025-12-01T21:32:56.590632-06:00"}
2025/12/01 21:32:56 {"details":"status=401","event":"request_complete","method":"POST","path":"/v1/detect","query":"","remote":"127.0.0.1:59796","request_id":"1764646376590610000","ts":"2025-12-01T21:32:56.59064-06:00","user_agent":"Go-http-client/1.1"}
--- PASS: TestUnauthorizedDetection (0.01s)
=== RUN   TestLoadLicenseValid
--- PASS: TestLoadLicenseValid (0.00s)
=== RUN   TestLoadLicenseInvalidSignature
--- PASS: TestLoadLicenseInvalidSignature (0.00s)
=== RUN   TestLoadLicenseExpired
--- PASS: TestLoadLicenseExpired (0.00s)
=== RUN   TestTenantRateLimiter_TenantLimit
--- PASS: TestTenantRateLimiter_TenantLimit (0.00s)
=== RUN   TestTenantRateLimiter_KeyLimit
--- PASS: TestTenantRateLimiter_KeyLimit (0.00s)
=== RUN   TestDecorateRateLimitHeaders
--- PASS: TestDecorateRateLimitHeaders (0.00s)
FAIL
FAIL	github.com/Shannon-Labs/driftlock/collector-processor/cmd/driftlock-http	1.087s
FAIL
