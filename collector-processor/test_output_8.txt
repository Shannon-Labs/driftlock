# github.com/Shannon-Labs/driftlock/collector-processor/cmd/driftlock-http.test
ld: warning: ignoring duplicate libraries: '-lcbad_core'
=== RUN   TestBillingStatusEndpoint
2025/12/01 21:33:51 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59903","request_id":"1764646431822872000","ts":"2025-12-01T21:33:51.822884-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:51 {"details":"status=201","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59903","request_id":"1764646431822872000","ts":"2025-12-01T21:33:51.827929-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:51 {"event":"request_start","method":"GET","path":"/v1/onboard/verify","query":"token=04fDS06g0PQ3pFCOCysCEGtgBXbRnJa2on-jloKpqOQ=","remote":"127.0.0.1:59903","request_id":"1764646431828647000","ts":"2025-12-01T21:33:51.828648-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:51 {"details":"status=200","event":"request_complete","method":"GET","path":"/v1/onboard/verify","query":"token=04fDS06g0PQ3pFCOCysCEGtgBXbRnJa2on-jloKpqOQ=","remote":"127.0.0.1:59903","request_id":"1764646431828647000","ts":"2025-12-01T21:33:51.878137-06:00","user_agent":"Go-http-client/1.1"}
=== RUN   TestBillingStatusEndpoint/BillingStatusViaAPIKey
2025/12/01 21:33:51 {"event":"request_start","method":"GET","path":"/v1/me/billing","query":"","remote":"127.0.0.1:59903","request_id":"1764646431978464000","ts":"2025-12-01T21:33:51.978466-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:51 {"details":"http_status=401","error":"missing bearer token","error_type":"unauthorized","event":"error","method":"GET","path":"/v1/me/billing","remote":"127.0.0.1:59903","request_id":"1764646431978464000","ts":"2025-12-01T21:33:51.978483-06:00"}
2025/12/01 21:33:51 {"details":"status=401","event":"request_complete","method":"GET","path":"/v1/me/billing","query":"","remote":"127.0.0.1:59903","request_id":"1764646431978464000","ts":"2025-12-01T21:33:51.978501-06:00","user_agent":"Go-http-client/1.1"}
    e2e_billing_test.go:58: Billing endpoint requires Firebase Auth (expected in production)
--- PASS: TestBillingStatusEndpoint (0.19s)
    --- PASS: TestBillingStatusEndpoint/BillingStatusViaAPIKey (0.00s)
=== RUN   TestCheckoutSessionCreation
    e2e_billing_test.go:72: STRIPE_SECRET_KEY not set, skipping checkout test
--- SKIP: TestCheckoutSessionCreation (0.00s)
=== RUN   TestTrialCountdownAccuracy
2025/12/01 21:33:51 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59907","request_id":"1764646431999503000","ts":"2025-12-01T21:33:51.999503-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 {"details":"status=201","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59907","request_id":"1764646431999503000","ts":"2025-12-01T21:33:52.004139-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 {"event":"request_start","method":"GET","path":"/v1/onboard/verify","query":"token=m4le-2IBq4Vg-M9iIR10STPFInUChu_n9m0qbvfm5xs=","remote":"127.0.0.1:59907","request_id":"1764646432004835000","ts":"2025-12-01T21:33:52.004835-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 {"details":"status=200","event":"request_complete","method":"GET","path":"/v1/onboard/verify","query":"token=m4le-2IBq4Vg-M9iIR10STPFInUChu_n9m0qbvfm5xs=","remote":"127.0.0.1:59907","request_id":"1764646432004835000","ts":"2025-12-01T21:33:52.049174-06:00","user_agent":"Go-http-client/1.1"}
    e2e_billing_test.go:188: Trial ends at 2025-12-08T21:33:52-06:00, 6 days remaining
--- PASS: TestTrialCountdownAccuracy (0.07s)
=== RUN   TestGracePeriodLogic
2025/12/01 21:33:52 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59911","request_id":"1764646432063762000","ts":"2025-12-01T21:33:52.063762-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 {"details":"status=201","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59911","request_id":"1764646432063762000","ts":"2025-12-01T21:33:52.066943-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 {"event":"request_start","method":"GET","path":"/v1/onboard/verify","query":"token=801xetyqLJNzaoZgmCd19qxjYze2qmZcA3proGQENqo=","remote":"127.0.0.1:59911","request_id":"1764646432067447000","ts":"2025-12-01T21:33:52.067447-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 {"details":"status=200","event":"request_complete","method":"GET","path":"/v1/onboard/verify","query":"token=801xetyqLJNzaoZgmCd19qxjYze2qmZcA3proGQENqo=","remote":"127.0.0.1:59911","request_id":"1764646432067447000","ts":"2025-12-01T21:33:52.104298-06:00","user_agent":"Go-http-client/1.1"}
=== RUN   TestGracePeriodLogic/SetGracePeriod
    e2e_billing_test.go:248: Grace period set until 2025-12-08T21:33:52-06:00, failure count: 1
=== RUN   TestGracePeriodLogic/ClearGracePeriod
    e2e_billing_test.go:274: Grace period cleared successfully
--- PASS: TestGracePeriodLogic (0.06s)
    --- PASS: TestGracePeriodLogic/SetGracePeriod (0.00s)
    --- PASS: TestGracePeriodLogic/ClearGracePeriod (0.00s)
=== RUN   TestWebhookSignatureRequired
2025/12/01 21:33:52 {"event":"request_start","method":"POST","path":"/v1/billing/webhook","query":"","remote":"127.0.0.1:59915","request_id":"1764646432120588000","ts":"2025-12-01T21:33:52.120589-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 Error verifying webhook signature: webhook has no Stripe-Signature header
2025/12/01 21:33:52 {"details":"status=400","event":"request_complete","method":"POST","path":"/v1/billing/webhook","query":"","remote":"127.0.0.1:59915","request_id":"1764646432120588000","ts":"2025-12-01T21:33:52.120626-06:00","user_agent":"Go-http-client/1.1"}
    e2e_billing_test.go:300: Webhook correctly rejected (status 400)
--- PASS: TestWebhookSignatureRequired (0.01s)
=== RUN   TestOnboardingFlow
=== RUN   TestOnboardingFlow/SignupCreatesUnverifiedTenant
2025/12/01 21:33:52 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59919","request_id":"1764646432130559000","ts":"2025-12-01T21:33:52.13056-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 {"details":"status=201","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59919","request_id":"1764646432130559000","ts":"2025-12-01T21:33:52.133553-06:00","user_agent":"Go-http-client/1.1"}
=== RUN   TestOnboardingFlow/VerifyActivatesTenant
2025/12/01 21:33:52 {"event":"request_start","method":"GET","path":"/v1/onboard/verify","query":"token=KgdNcAccdneC9zYNn4_f5XgY1Fo8CehiwwxtRHLeep0=","remote":"127.0.0.1:59919","request_id":"1764646432135583000","ts":"2025-12-01T21:33:52.135584-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 {"details":"status=200","event":"request_complete","method":"GET","path":"/v1/onboard/verify","query":"token=KgdNcAccdneC9zYNn4_f5XgY1Fo8CehiwwxtRHLeep0=","remote":"127.0.0.1:59919","request_id":"1764646432135583000","ts":"2025-12-01T21:33:52.171024-06:00","user_agent":"Go-http-client/1.1"}
    e2e_onboarding_test.go:83: Got API key: dlk_a3ae80...
--- PASS: TestOnboardingFlow (0.05s)
    --- PASS: TestOnboardingFlow/SignupCreatesUnverifiedTenant (0.00s)
    --- PASS: TestOnboardingFlow/VerifyActivatesTenant (0.04s)
=== RUN   TestSignupValidation
=== RUN   TestSignupValidation/MissingEmail
2025/12/01 21:33:52 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59923","request_id":"1764646432182959000","ts":"2025-12-01T21:33:52.182959-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 {"details":"http_status=400","error":"email is required","error_type":"invalid_argument","event":"error","method":"POST","path":"/v1/onboard/signup","remote":"127.0.0.1:59923","request_id":"1764646432182959000","ts":"2025-12-01T21:33:52.182985-06:00"}
2025/12/01 21:33:52 {"details":"status=400","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59923","request_id":"1764646432182959000","ts":"2025-12-01T21:33:52.182994-06:00","user_agent":"Go-http-client/1.1"}
=== RUN   TestSignupValidation/InvalidEmail
2025/12/01 21:33:52 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59923","request_id":"1764646432183104000","ts":"2025-12-01T21:33:52.183104-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 {"details":"http_status=400","error":"invalid email format","error_type":"invalid_argument","event":"error","method":"POST","path":"/v1/onboard/signup","remote":"127.0.0.1:59923","request_id":"1764646432183104000","ts":"2025-12-01T21:33:52.183118-06:00"}
2025/12/01 21:33:52 {"details":"status=400","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59923","request_id":"1764646432183104000","ts":"2025-12-01T21:33:52.183125-06:00","user_agent":"Go-http-client/1.1"}
=== RUN   TestSignupValidation/MissingCompanyName
2025/12/01 21:33:52 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59923","request_id":"1764646432183275000","ts":"2025-12-01T21:33:52.183275-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 {"details":"http_status=400","error":"company_name is required","error_type":"invalid_argument","event":"error","method":"POST","path":"/v1/onboard/signup","remote":"127.0.0.1:59923","request_id":"1764646432183275000","ts":"2025-12-01T21:33:52.183284-06:00"}
2025/12/01 21:33:52 {"details":"status=400","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59923","request_id":"1764646432183275000","ts":"2025-12-01T21:33:52.183289-06:00","user_agent":"Go-http-client/1.1"}
=== RUN   TestSignupValidation/CompanyNameTooShort
2025/12/01 21:33:52 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59923","request_id":"1764646432183379000","ts":"2025-12-01T21:33:52.183379-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 {"details":"http_status=400","error":"company_name must be at least 2 characters","error_type":"invalid_argument","event":"error","method":"POST","path":"/v1/onboard/signup","remote":"127.0.0.1:59923","request_id":"1764646432183379000","ts":"2025-12-01T21:33:52.18339-06:00"}
2025/12/01 21:33:52 {"details":"status=400","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59923","request_id":"1764646432183379000","ts":"2025-12-01T21:33:52.183395-06:00","user_agent":"Go-http-client/1.1"}
=== RUN   TestSignupValidation/InvalidPlan
2025/12/01 21:33:52 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59923","request_id":"1764646432183480000","ts":"2025-12-01T21:33:52.18348-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 {"details":"http_status=400","error":"invalid plan: must be one of trial, starter, growth, pilot","error_type":"invalid_argument","event":"error","method":"POST","path":"/v1/onboard/signup","remote":"127.0.0.1:59923","request_id":"1764646432183480000","ts":"2025-12-01T21:33:52.183493-06:00"}
2025/12/01 21:33:52 {"details":"status=400","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59923","request_id":"1764646432183480000","ts":"2025-12-01T21:33:52.1835-06:00","user_agent":"Go-http-client/1.1"}
--- PASS: TestSignupValidation (0.01s)
    --- PASS: TestSignupValidation/MissingEmail (0.00s)
    --- PASS: TestSignupValidation/InvalidEmail (0.00s)
    --- PASS: TestSignupValidation/MissingCompanyName (0.00s)
    --- PASS: TestSignupValidation/CompanyNameTooShort (0.00s)
    --- PASS: TestSignupValidation/InvalidPlan (0.00s)
=== RUN   TestDuplicateEmailRejected
2025/12/01 21:33:52 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59927","request_id":"1764646432193913000","ts":"2025-12-01T21:33:52.193913-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 {"details":"status=201","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59927","request_id":"1764646432193913000","ts":"2025-12-01T21:33:52.197557-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59927","request_id":"1764646432197659000","ts":"2025-12-01T21:33:52.197659-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 {"details":"http_status=409","error":"email already registered","error_type":"internal","event":"error","method":"POST","path":"/v1/onboard/signup","remote":"127.0.0.1:59927","request_id":"1764646432197659000","ts":"2025-12-01T21:33:52.197923-06:00"}
2025/12/01 21:33:52 {"details":"status=409","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59927","request_id":"1764646432197659000","ts":"2025-12-01T21:33:52.197935-06:00","user_agent":"Go-http-client/1.1"}
--- PASS: TestDuplicateEmailRejected (0.02s)
=== RUN   TestVerificationTokenValidation
=== RUN   TestVerificationTokenValidation/MissingToken
2025/12/01 21:33:52 {"event":"request_start","method":"GET","path":"/v1/onboard/verify","query":"","remote":"127.0.0.1:59931","request_id":"1764646432210216000","ts":"2025-12-01T21:33:52.210216-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 {"details":"http_status=400","error":"verification token required","error_type":"invalid_argument","event":"error","method":"GET","path":"/v1/onboard/verify","remote":"127.0.0.1:59931","request_id":"1764646432210216000","ts":"2025-12-01T21:33:52.210233-06:00"}
2025/12/01 21:33:52 {"details":"status=400","event":"request_complete","method":"GET","path":"/v1/onboard/verify","query":"","remote":"127.0.0.1:59931","request_id":"1764646432210216000","ts":"2025-12-01T21:33:52.21024-06:00","user_agent":"Go-http-client/1.1"}
=== RUN   TestVerificationTokenValidation/InvalidToken
2025/12/01 21:33:52 {"event":"request_start","method":"GET","path":"/v1/onboard/verify","query":"token=invalid_token_xyz","remote":"127.0.0.1:59931","request_id":"1764646432210376000","ts":"2025-12-01T21:33:52.210376-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 {"details":"http_status=400","error":"invalid or expired verification token","error_type":"invalid_argument","event":"error","method":"GET","path":"/v1/onboard/verify","remote":"127.0.0.1:59931","request_id":"1764646432210376000","ts":"2025-12-01T21:33:52.210924-06:00"}
2025/12/01 21:33:52 {"details":"status=400","event":"request_complete","method":"GET","path":"/v1/onboard/verify","query":"token=invalid_token_xyz","remote":"127.0.0.1:59931","request_id":"1764646432210376000","ts":"2025-12-01T21:33:52.210934-06:00","user_agent":"Go-http-client/1.1"}
--- PASS: TestVerificationTokenValidation (0.01s)
    --- PASS: TestVerificationTokenValidation/MissingToken (0.00s)
    --- PASS: TestVerificationTokenValidation/InvalidToken (0.00s)
=== RUN   TestSignupRateLimiting
2025/12/01 21:33:52 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59935","request_id":"1764646432221426000","ts":"2025-12-01T21:33:52.221427-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 {"details":"status=201","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59935","request_id":"1764646432221426000","ts":"2025-12-01T21:33:52.226991-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59935","request_id":"1764646432227154000","ts":"2025-12-01T21:33:52.227154-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 {"details":"http_status=500","error":"failed to create tenant: ERROR: duplicate key value violates unique constraint \"tenants_slug_key\" (SQLSTATE 23505)","error_type":"internal","event":"error","method":"POST","path":"/v1/onboard/signup","remote":"127.0.0.1:59935","request_id":"1764646432227154000","ts":"2025-12-01T21:33:52.228327-06:00"}
2025/12/01 21:33:52 {"details":"status=500","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59935","request_id":"1764646432227154000","ts":"2025-12-01T21:33:52.228338-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59935","request_id":"1764646432228427000","ts":"2025-12-01T21:33:52.228428-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 {"details":"http_status=500","error":"failed to create tenant: ERROR: duplicate key value violates unique constraint \"tenants_slug_key\" (SQLSTATE 23505)","error_type":"internal","event":"error","method":"POST","path":"/v1/onboard/signup","remote":"127.0.0.1:59935","request_id":"1764646432228427000","ts":"2025-12-01T21:33:52.229306-06:00"}
2025/12/01 21:33:52 {"details":"status=500","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59935","request_id":"1764646432228427000","ts":"2025-12-01T21:33:52.229318-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59935","request_id":"1764646432229410000","ts":"2025-12-01T21:33:52.22941-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 {"details":"http_status=500","error":"failed to create tenant: ERROR: duplicate key value violates unique constraint \"tenants_slug_key\" (SQLSTATE 23505)","error_type":"internal","event":"error","method":"POST","path":"/v1/onboard/signup","remote":"127.0.0.1:59935","request_id":"1764646432229410000","ts":"2025-12-01T21:33:52.230289-06:00"}
2025/12/01 21:33:52 {"details":"status=500","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59935","request_id":"1764646432229410000","ts":"2025-12-01T21:33:52.230297-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59935","request_id":"1764646432230395000","ts":"2025-12-01T21:33:52.230395-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 {"details":"http_status=500","error":"failed to create tenant: ERROR: duplicate key value violates unique constraint \"tenants_slug_key\" (SQLSTATE 23505)","error_type":"internal","event":"error","method":"POST","path":"/v1/onboard/signup","remote":"127.0.0.1:59935","request_id":"1764646432230395000","ts":"2025-12-01T21:33:52.231221-06:00"}
2025/12/01 21:33:52 {"details":"status=500","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59935","request_id":"1764646432230395000","ts":"2025-12-01T21:33:52.231231-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59935","request_id":"1764646432231306000","ts":"2025-12-01T21:33:52.231306-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 {"details":"http_status=500","error":"failed to create tenant: ERROR: duplicate key value violates unique constraint \"tenants_slug_key\" (SQLSTATE 23505)","error_type":"internal","event":"error","method":"POST","path":"/v1/onboard/signup","remote":"127.0.0.1:59935","request_id":"1764646432231306000","ts":"2025-12-01T21:33:52.232126-06:00"}
2025/12/01 21:33:52 {"details":"status=500","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59935","request_id":"1764646432231306000","ts":"2025-12-01T21:33:52.232133-06:00","user_agent":"Go-http-client/1.1"}
    e2e_onboarding_test.go:220: Warning: Rate limiting may not have triggered in test environment
--- PASS: TestSignupRateLimiting (0.02s)
=== RUN   TestAPIKeyAuthAfterVerification
2025/12/01 21:33:52 {"event":"request_start","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59939","request_id":"1764646432245892000","ts":"2025-12-01T21:33:52.245893-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 {"details":"status=201","event":"request_complete","method":"POST","path":"/v1/onboard/signup","query":"","remote":"127.0.0.1:59939","request_id":"1764646432245892000","ts":"2025-12-01T21:33:52.249054-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 {"event":"request_start","method":"GET","path":"/v1/onboard/verify","query":"token=PVBf-4i0L9DQcE25ljNpTlurTYViPXLx-5cQBtPySRg=","remote":"127.0.0.1:59939","request_id":"1764646432249762000","ts":"2025-12-01T21:33:52.249763-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 {"details":"status=200","event":"request_complete","method":"GET","path":"/v1/onboard/verify","query":"token=PVBf-4i0L9DQcE25ljNpTlurTYViPXLx-5cQBtPySRg=","remote":"127.0.0.1:59939","request_id":"1764646432249762000","ts":"2025-12-01T21:33:52.289372-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 {"event":"request_start","method":"POST","path":"/v1/detect","query":"","remote":"127.0.0.1:59939","request_id":"1764646432389745000","ts":"2025-12-01T21:33:52.389746-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 {"details":"status=200","event":"request_complete","method":"POST","path":"/v1/detect","query":"","remote":"127.0.0.1:59939","request_id":"1764646432389745000","ts":"2025-12-01T21:33:52.430532-06:00","user_agent":"Go-http-client/1.1"}
    e2e_onboarding_test.go:282: Detection successful: 3 events, 0 anomalies
--- PASS: TestAPIKeyAuthAfterVerification (0.20s)
=== RUN   TestUnauthorizedDetection
2025/12/01 21:33:52 {"event":"request_start","method":"POST","path":"/v1/detect","query":"","remote":"127.0.0.1:59944","request_id":"1764646432447586000","ts":"2025-12-01T21:33:52.447587-06:00","user_agent":"Go-http-client/1.1"}
2025/12/01 21:33:52 {"details":"http_status=401","error":"missing api key","error_type":"unauthorized","event":"error","method":"POST","path":"/v1/detect","remote":"127.0.0.1:59944","request_id":"1764646432447586000","ts":"2025-12-01T21:33:52.447607-06:00"}
2025/12/01 21:33:52 {"details":"status=401","event":"request_complete","method":"POST","path":"/v1/detect","query":"","remote":"127.0.0.1:59944","request_id":"1764646432447586000","ts":"2025-12-01T21:33:52.447614-06:00","user_agent":"Go-http-client/1.1"}
--- PASS: TestUnauthorizedDetection (0.01s)
=== RUN   TestLoadLicenseValid
--- PASS: TestLoadLicenseValid (0.00s)
=== RUN   TestLoadLicenseInvalidSignature
--- PASS: TestLoadLicenseInvalidSignature (0.00s)
=== RUN   TestLoadLicenseExpired
--- PASS: TestLoadLicenseExpired (0.00s)
=== RUN   TestTenantRateLimiter_TenantLimit
--- PASS: TestTenantRateLimiter_TenantLimit (0.00s)
=== RUN   TestTenantRateLimiter_KeyLimit
--- PASS: TestTenantRateLimiter_KeyLimit (0.00s)
=== RUN   TestDecorateRateLimitHeaders
--- PASS: TestDecorateRateLimitHeaders (0.00s)
PASS
ok  	github.com/Shannon-Labs/driftlock/collector-processor/cmd/driftlock-http	1.059s
