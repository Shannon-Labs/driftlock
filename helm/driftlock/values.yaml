# Default values for driftlock.

# Image configuration
image:
  repository: driftlock/api
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  tag: ""

# Service configuration
service:
  type: ClusterIP
  port: 80
  targetPort: 8080

# Ingress configuration
ingress:
  enabled: false
  className: ""
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # kubernetes.io/tls-acme: "true"
  hosts:
    - host: chart-example.local
      paths:
        - path: /
          pathType: ImplementationSpecific
  tls: []
  #  - secretName: chart-example-tls
  #    hosts:
  #      - chart-example.local

# Resource limits and requests
resources:
  # We usually recommend not to specify default resources and to leave this as a conscious
  # choice for the user. This also increases chances charts run on environments with little
  # resources, such as Minikube. If you do want to specify resources, uncomment the following
  # lines, adjust them as necessary, and remove the curly braces after 'resources:'.
  limits:
    cpu: 500m
    memory: 1Gi
  requests:
    cpu: 250m
    memory: 512Mi

# Node labels for pod assignment
nodeSelector: {}

# Tolerations for node taints
tolerations: []

# Affinity settings
affinity: {}

# Database configuration
database:
  # If true, PostgreSQL will be deployed as part of this chart
  enabled: true
  # If false, provide external database connection details
  external:
    enabled: false
    host: ""
    port: 5432
    database: ""
    username: ""
    password: ""

# Redis configuration (for caching and sessions)
redis:
  enabled: true

# Kafka configuration (for streaming)
kafka:
  enabled: true
  replicaCount: 3
  persistence:
    enabled: true
    size: 10Gi
  zookeeper:
    persistence:
      enabled: true
      size: 5Gi
  listeners:
    client:
      containerPort: 9092
      protocol: PLAINTEXT
      name: CLIENT
    controller:
      name: CONTROLLER
      containerPort: 9093
      protocol: PLAINTEXT
    interbroker:
      containerPort: 9094
      protocol: PLAINTEXT
      name: INTERNAL
    external:
      containerPort: 9095
      protocol: PLAINTEXT
      name: EXTERNAL

# ClickHouse configuration (for analytics storage)
clickhouse:
  enabled: true
  replicaCount: 2
  persistence:
    enabled: true
    size: 20Gi
  configmap:
    remote_servers:
      replica_count: 2
    zookeeper_servers:
      - host: zookeeper
        port: 2181
    users:
      - name: default
        password: ""
        networks:
          - 127.0.0.1
          - ::1

# Prometheus configuration (for monitoring)
prometheus:
  enabled: true
  server:
    replicaCount: 2
    retention: "15d"
    persistentVolume:
      enabled: true
      size: 20Gi
    resources:
      requests:
        cpu: 200m
        memory: 1000Mi
      limits:
        cpu: 1000m
        memory: 2000Mi
  alertmanager:
    enabled: true
    replicaCount: 1
    persistentVolume:
      enabled: true
      size: 2Gi
  nodeExporter:
    enabled: true
  kubeStateMetrics:
    enabled: true
  pushgateway:
    enabled: false

# Grafana configuration (for dashboards)
grafana:
  enabled: true
  replicaCount: 2
  persistence:
    enabled: true
    size: 5Gi
  adminUser: admin
  adminPassword: admin123
  service:
    type: LoadBalancer
    port: 3000
  datasources:
    datasources.yaml:
      apiVersion: 1
      datasources:
        - name: Prometheus
          type: prometheus
          url: http://prometheus-server
          access: proxy
          isDefault: true
  dashboardProviders:
    dashboardproviders.yaml:
      apiVersion: 1
      providers:
        - name: 'default'
          orgId: 1
          folder: ''
          type: file
          disableDeletion: false
          editable: true
          options:
            path: /var/lib/grafana/dashboards/default
  dashboards:
    default:
      driftlock-overview:
        gnetId: null
        revision: null
        datasource: Prometheus

# API server configuration
api:
  replicaCount: 3
  logLevel: "info"
  environment: "production"
  readTimeout: "30s"
  writeTimeout: "30s"
  idleTimeout: "60s"
  
  # Autoscaling configuration
  autoscaling:
    enabled: false
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80
  
  # Feature flags
  features:
    enableSSEStreaming: true
    enableEvidenceExport: true
  
  # Rate limiting
  rateLimit:
    globalRPS: 1000
    globalBurst: 2000

# Security settings
security:
  # Security context for containers
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: true
    capabilities:
      drop:
      - ALL

# Probes
livenessProbe:
  initialDelaySeconds: 30
  periodSeconds: 10
readinessProbe:
  initialDelaySeconds: 5
  periodSeconds: 5

# Service Account configuration
serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

# Pod Annotations
podAnnotations: {}

# Pod Security Context
podSecurityContext: {}
  # fsGroup: 2000

# Additional environment variables
extraEnv: []

# Additional environment variables from secrets or configmaps
extraEnvFrom: []

# Network policy configuration
networkPolicy:
  enabled: true

# PodDisruptionBudget configuration
podDisruptionBudget:
  enabled: true
  minAvailable: 1

# ServiceMonitor configuration for Prometheus
serviceMonitor:
  enabled: true
  interval: 30s
  scrapeTimeout: 10s
  labels: {}

# PrometheusRule configuration for alerting
prometheusRule:
  enabled: false
  labels: {}

# PodSecurityPolicy configuration
podSecurityPolicy:
  enabled: true

# ResourceQuota configuration
resourceQuota:
  enabled: true
  requests:
    cpu: "2"
    memory: "4Gi"
  limits:
    cpu: "4"
    memory: "8Gi"
  persistentvolumeclaims: "10"
  pods: "20"
  services: "10"
  secrets: "10"
  configmaps: "10"

# LimitRange configuration
limitRange:
  enabled: true
  default:
    cpu: "100m"
    memory: "128Mi"
  defaultRequest:
    cpu: "50m"
    memory: "64Mi"
  max:
    cpu: "2"
    memory: "4Gi"
  min:
    cpu: "10m"
    memory: "16Mi"

# Alertmanager configuration
alertmanager:
  smtp:
    host: "smtp.example.com"
    port: 587
    from: "alerts@driftlock.com"
    username: "alerts@driftlock.com"
    password: "smtp-password"
  email:
    critical: "critical@driftlock.com"
    warning: "warning@driftlock.com"