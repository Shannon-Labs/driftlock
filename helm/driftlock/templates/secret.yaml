apiVersion: v1
kind: Secret
metadata:
  name: {{ include "driftlock.fullname" . }}-secrets
  labels:
    {{- include "driftlock.labels" . | nindent 4 }}
type: Opaque
data:
  # These should be base64 encoded values
  # Generate with: echo -n 'your-secret-value' | base64
  {{- if .Values.database.enabled }}
  database-url: {{ .Values.database.external.enabled | ternary (printf "postgresql://%s:%s@%s:%d/%s?sslmode=require" .Values.database.external.username .Values.database.external.password .Values.database.external.host .Values.database.external.port .Values.database.external.database | b64enc) (printf "postgresql://postgres:%s@%s-postgresql:5432/%s?sslmode=require" .Values.postgresql.auth.password (include "driftlock.fullname" .) .Values.postgresql.auth.database | b64enc) }}
  {{- end }}
  jwt-secret: {{ .Values.jwtSecret | default (randAlphaNum 32) | b64enc }}
  {{- if .Values.redis.enabled }}
  redis-password: {{ .Values.redis.auth.enabled | ternary .Values.redis.auth.password (randAlphaNum 16) | b64enc }}
  {{- end }}
  {{- if .Values.clickhouse.enabled }}
  clickhouse-password: {{ .Values.clickhouse.auth.enabled | ternary .Values.clickhouse.auth.password (randAlphaNum 16) | b64enc }}
  {{- end }}
