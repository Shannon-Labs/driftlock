#!/bin/bash

echo "DriftLock API Gateway - Stripe Webhook Configuration Complete! ðŸš€"

echo ""
echo "âœ… Cloudflare Worker updated with Stripe webhook handling"
echo "âœ… Webhook endpoint configured at root path ('/')"
echo "âœ… Supports all essential Stripe events:"
echo "   - checkout.session.completed"
echo "   - customer.subscription.*"
echo "   - invoice.payment_*"
echo "   - And more based on your Stripe dashboard configuration"
echo ""
echo "ðŸ“‹ Next Steps:"
echo ""
echo "1. Set your secrets (if not already done):"
echo "   wrangler secret put ENV_SUPABASE_SERVICE_ROLE_KEY"
echo "   wrangler secret put ENV_JWT_SECRET" 
echo "   wrangler secret put ENV_STRIPE_WEBHOOK_SECRET  # Use: whsec_DHBt7I8WKbWVb1RK0mGAg51hcRLZ7CSC"
echo ""
echo "2. Update your Stripe webhook URL to your deployed worker (when ready):"
echo "   Current Stripe URL: https://www.driftlock.net/api/"
echo "   Suggested Worker URL: https://driftlock-api-gateway.YOUR_USERNAME.workers.dev/"
echo ""
echo "3. Deploy the updated worker:"
echo "   wrangler deploy"
echo ""
echo "4. In your Stripe dashboard, make sure the webhook endpoint is set correctly"
echo "   and that it's listening to all the required events"
echo ""
echo "The worker is now ready to handle both API requests and Stripe webhooks!"
echo ""
echo "API requests: Bearer token authentication â†’ Supabase validation â†’ Backend proxy"
echo "Stripe webhooks: Signature verification â†’ Event processing â†’ Supabase updates"